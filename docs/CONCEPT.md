# 概念設計 (Conceptual Design)

本システムの中心的概念である「案件 (Project)」と「請求書 (Bill)」の違い、および業務フローについて定義します。

## 1. コアモデルの定義

### 案件 (Project / Job)
- **コード上のモデル名**: `Invoice`
- **意味**: 制作業務の管理単位。「1つの動画制作」「1つの配信対応」など。
- **特徴**:
    - 開始日、納期、担当者（PM/経理）、品目（Items）、タスク（Outsources）を持つ。
    - ステータス: `受注前` → `進行中` → `納品済` → `請求書作成済` (Monthly Bill化された状態) → `送付済` → ...
    - **注意**: コード上は `Invoice` という名前ですが、業務実態としては「制作管理シート」に近い役割を果たします。

### 月次請求書 (Monthly Bill)
- **コード上のモデル名**: `Bill`
- **意味**: クライアントに送付する実際の請求書。
- **特徴**:
    - **1つのクライアント** に対して、**その月に納品された複数の案件 (`Invoice`)** をまとめて1枚の請求書にします（「締め請求」の概念）。
    - 合計金額、発行日、支払期限を持ちます。
    - ステータス: `Issued` (発行済) → `Paid` (入金済)

---

## 2. 業務ワークフロー

### Step 1: 案件登録 (Invoice Creation)
1. **PM (Operations)** が新規案件 (`Invoice`) を作成します。
2. 品目 (`InvoiceItem`) と、それに紐づくタスク (`Outsource`) を定義します。
3. タスクごとにパートナー（外注先）や料金ルールを割り当て、原価と売上を管理します。

### Step 2: 制作進行 & 納品 (Production & Delivery)
1. 業務が進行し、タスクごとのステータスが更新されます。
2. 全てのタスクが完了し、成果物が納品されると、案件のステータスを `納品済` にします。
3. `納品済` になった案件は「売上」として計上できる状態になります。

### Step 3: 月次請求作成 (Billing)
1. **経理 (Accounting)** またはPMが「月次請求管理画面」(`BillingDashboard`) を開きます。
2. クライアントごとに、まだ請求書になっていない `納品済` の案件がリストアップされます。
3. 対象期間（例: 前月納品分）の案件を選択し、「請求書を発行 (`Create Consolidated Bill`)」します。
4. これにより `Bill` レコードが作成され、紐づく `Invoice` のステータスが `請求書作成済` に更新されます。

### Step 4: 請求書送付 & 入金 (Sending & Payment)
1. 作成された `Bill` (PDF/Webビュー) を確認し、クライアントへ送付します。
2. `Invoice` のステータスを `送付済` に更新します。
3. 入金が確認されたら、`Bill` を `入金済 (Paid)` にします。
4. 自動的に紐づく `Invoice` も `完了` または `入金済` 扱いとなります。

## 3. その他の重要概念

### 料金ルール (Pricing Rule)
- クライアントごとの単価設定や、パートナーごとの原価設定をテンプレート化したもの。
- 尺（Duration）に基づく自動計算ロジックを持ちます。

### スタッフ招待 (Staff Invitation)
- 管理者が招待リンクを発行し、新しいスタッフ（PM/経理）をシステムに追加できます。

---

> [!IMPORTANT]
> **用語の注意**:
> コードベース内で `Invoice` と記述されている場合、それは「請求書」そのものではなく、多くの場合「案件(Job)」を指します。
> 実際の請求書機能は `Bill` モデルとして分離されています。
